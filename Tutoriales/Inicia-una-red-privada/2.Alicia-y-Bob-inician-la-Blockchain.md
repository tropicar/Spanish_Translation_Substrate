# Alicia y Bob inician la blockchain

Antes de generar nuestras propias claves, y empezar una √∫nica red de Substrate, vamos a aprender lo b√°sico, empezando por las especificaciones por defecto de la red, el t√©rmino local con 2 predefinididas (definitivamente no son privadas!) claves conocidas como Alice y Bob.

Esta parte del tutorial deber√≠a ejecutar en una √∫nica estaci√≥n de trabajo con un solo binario Substrate. Si has seguido el tutorial hasta este punto, tienes la configuraci√≥n correcta.

## Alice comienza primero

Alice (o quienquiera que sea) deber√≠a ejecutar los siguientes comandos desde la ra√≠z del repositorio de la plantilla "node-template".

Aqu√≠ hemos usado expl√≠citamente el comando purge-chain. En el futuro omitiremos √©sto. Deber√≠as purgar los datos antiguos de la blockchain siempre que est√©s iniciando una nueva red.

~~~
# Elimina cualquier dato de una ejecuci√≥n anterior
# Solo te pedir√° que escribas `y`
./target/release/node-template purge-chain --base-path /tmp/alice --chain local

# Start Alice's node
./target/release/node-template \
  --base-path /tmp/alice \
  --chain local \
  --alice \
  --port 30333 \
  --ws-port 9945 \
  --rpc-port 9933 \
  --node-key 0000000000000000000000000000000000000000000000000000000000000001 \
  --telemetry-url 'wss://telemetry.polkadot.io/submit/ 0' \
  --validator
~~~

| Flags             | Descripciones                                        | 
| :-----------------| :---------------------------------------------------:| 
|  --base-path      | Especifica un directorio d√≥nde Substrate deber√≠a almacenar todos los datos relacionados con esta blockchain. Si este valor no se especifica, se usar√° una ruta por defecto. Si el directorio no existe, ser√° creado autom√°ticamente. Si ya existiesen datos de otra blockchain, aparecer√≠a un error. De cualquier forma, borra el directorio o elige uno diferente.| 
| --chain local     |Especifica que tipo de blockchain utilizar. Hay algunas opciones predefinidas como son local,development, y staging pero, generalmente, cada uno detalla sus especificaciones en el archivo chainspec. Personalizaremos nuestro propio archivo en pasos posteriores.    |
| --Alice           | Pone las claves predefinidas de Alice(ambas se utilizan para producci√≥n y finalizaci√≥n) en la keystore del nodo. Normalmente cada uno deber√≠a generar sus propias keys e insertarlas con una llamada RPC. Generaremos nuestras propias keys en el √∫ltimo paso. Esta flag tambi√©n crea a Alice como validador.                                                |
| --port 30333      | Especifica el puerto por el que tu nodo va a estar escuchando el tr√°fico p2p. El puerto por defecto es el 30333, esta flag puede ser omitida si est√°s satisfecho por la opci√≥n por defecto. En el caso de que el nodo de Bob se ejecutara en el mismo sistema f√≠sico, necesitar√≠as especificar un puerto diferente.                                                   |
| --ws-port 9945    | Especifica el puerto en el que su nodo escuchar√° el tr√°fico entrante de WebSocket. El valor predeterminado es 9944. Este ejemplo utiliza un n√∫mero de puerto de socket web personalizado (9945).                                                               |
|--rpc-port 9933    | Especifica el puerto por el que tu nodo escuchar√° el tr√°fico RPC. El puerto por defecto es el 9933, por lo que puede ser omitido.                   |
|--node-key "`<`key`>`    | La secret key Ed25519 a usar por la red libp2p. El valor se codifica en c√≥digo hexadecimal siendo as√≠ una secret key Ed25519 de 32 bytes codificada hexadecimal, por ejemplo, 64 caracteres hex. ATENCI√ìN: Los secretos proporcionados como argumentos de l√≠nea de comandos se pueden exponer f√°cilmente. El uso de esta opci√≥n deber√≠a limitarse al desarrollo y al testing.                   |
| --telemetry-url   | Indica al nodo que env√≠e datos de telemetr√≠a a un server en particular. La que hemos elegido aqu√≠ est√° alojada por Parity y est√° disponible para que cualquier la utilice. T√∫ tambi√©n puedes alojar la tuya propia(m√°s all√° del alcance de este tutorial u omitir esta flag completamente.).                                                        |
| --validator       | Significa que queremos participar en la producci√≥n de bloques y en la finalizaci√≥n, no solo estar sincronizados con la red.                   |

Cuando el nodo se inicie deber√≠as ver una salida similar a √©sta.

~~~
Sep 24 12:53:30.728  INFO Substrate Node    
Sep 24 12:53:30.728  INFO ‚úåÔ∏è  version 2.0.0-24da767-x86_64-linux-gnu    
Sep 24 12:53:30.729  INFO ‚ù§Ô∏è  by Substrate DevHub <https://github.com/substrate-developer-hub>, 2017-2020    
Sep 24 12:53:30.729  INFO üìã Chain specification: Local Testnet    
Sep 24 12:53:30.729  INFO üè∑  Node name: Alice    
Sep 24 12:53:30.729  INFO üë§ Role: AUTHORITY    
Sep 24 12:53:30.729  INFO üíæ Database: RocksDb at /tmp/alice/chains/local_testnet/db    
Sep 24 12:53:30.729  INFO ‚õì  Native runtime: node-template-1 (node-template-1.tx1.au1)    
Sep 24 12:53:32.312  INFO üî® Initializing Genesis block/state (state: 0x0118‚Ä¶493b, header-hash: 0x2533‚Ä¶1d36)    
Sep 24 12:53:32.315  INFO üë¥ Loading GRANDPA authority set from genesis on what appears to be first startup.    
Sep 24 12:53:32.474  INFO ‚è±  Loaded block-time = 6000 milliseconds from genesis on first-launch    
Sep 24 12:53:32.475  WARN Using default protocol ID "sup" because none is configured in the chain specs    
Sep 24 12:53:32.475  INFO üè∑  Local node identity is: 12D3KooWEyoppNCUx8Yx66oV9fJnriXwCcXwDDUA2kj6vnc6iDEp (legacy representation: 12D3KooWEyoppNCUx8Yx66oV9fJnriXwCcXwDDUA2kj6vnc6iDEp)    
Sep 24 12:53:32.704  INFO üì¶ Highest known block at #0    
Sep 24 12:53:32.705  INFO „ÄΩÔ∏è Prometheus server started at 127.0.0.1:9615    
Sep 24 12:53:32.730  INFO Listening for new connections on 127.0.0.1:9944.    
Sep 24 12:53:37.733  INFO üí§ Idle (0 peers), best: #0 (0x2533‚Ä¶1d36), finalized #0 (0x2533‚Ä¶1d36), ‚¨á 0 ‚¨Ü 0    
Sep 24 12:53:42.734  INFO üí§ Idle (0 peers), best: #0 (0x2533‚Ä¶1d36), finalized #0 (0x2533‚Ä¶1d36), ‚¨á 0 ‚¨Ü 0
...
~~~

Notas

üî® Initializing Genesis block/state (estado: 0xa244‚Ä¶0444, header-hash: 0x1814‚Ä¶8aac) indica cu√°l bloque del g√©nesis est√° utilizando el nodo. Cuando inicie el siguiente nodo, verifique que estos valores son similares.

üè∑ Local node identity is: 12D3KooWEyoppNCUx8Yx66oV9fJnriXwCcXwDDUA2kj6vnc6iDEp... muestra el Peer ID que Bob necesitar√° cuando iniciemos desde el nodo de Alice. Este valor est√° determinado por el --node-key que fue utilizado al iniciar el nodo de Alice.

Notar√°s que a√∫n no se est√°n produciendo bloques. Los bloques comenzar√°n a ser producidos una vez que otro nodo se una a la red.

M√°s detalles sobre todas estas flags y otras que no he mencionado est√°n disponibles ejecutando 

~~~
./target/release/node-template --help.
~~~

## Adjuntar una UI(Interfaz de Usuario)

Puedes saber mucho sobre tu nodo viendo la salida que que aparece en tu terminal. Hay tambi√©n una fant√°stica interfaz gr√°fica de usuario conocida como Polkadot-JS Apps, tambi√©n conocida como "Apps".
En tu navegador, dir√≠jase a https://polkadot.js.org/apps/#/settings?rpc=ws://127.0.0.1:9945.

Algunos navegadores, especialmente Firefox, no se conectar√°n a un nodo local desde una web https. Una f√°cil soluciones ser√≠a utilizar otro navegador, como Chromium. Otra opci√≥n es alojar esta interfaz localmente.

El link que se ha proporcionado arriba incluye el par√°metro rpc en la URL, lo que indica a la UI de Apps que se conecte a la URL que es proporcionada por dicho valor(en este caso, tu nodo local). Para configurar manualmente la UI de Apps para que se conecte a otro nodo ser√≠a:

- Haga clic en el icono superior izquierdo network
- Aparecer√° un men√∫ desplegable. Elije la √∫ltima entrada, la cu√°l es un nodo local que utiliza un puerto por defecto 9944
- Para conectarse a un nodo y puerto personalizados, solo necesitar√°s especificar el endpoint eligiendo custom endpoint y escribirlo en tu propio endpoint. De esta manera, puedes utilizar una sola UI de Apps para conectarte a varios nodos.

Notas

Si no quieres ejecutar la versi√≥n alojada por la UI de Polkadot-JS Apps mientras se conecta al nodo Substrate que has desplegado de forma remota, puedes configurar ssh local port forwarding para reenviar las local request al ws-port que est√° escuchando en el host remoto. Esto est√° fuera del alcance de este tutorial pero se hace referencia en la parte inferior.

## Bob se une

Ahora que el nodo de Alice est√° activo y ejecut√°ndose, Bob puede unirse a la red desde su nodo. Su comando parece muy similar.

~~~
./target/release/node-template purge-chain --base-path /tmp/bob --chain local

./target/release/node-template \
  --base-path /tmp/bob \
  --chain local \
  --bob \
  --port 30334 \
  --ws-port 9946 \
  --rpc-port 9934 \
  --telemetry-url 'wss://telemetry.polkadot.io/submit/ 0' \
  --validator \
  --bootnodes /ip4/127.0.0.1/tcp/30333/p2p/12D3KooWEyoppNCUx8Yx66oV9fJnriXwCcXwDDUA2kj6vnc6iDEp
~~~

La mayor√≠a de estas opciones ya han sido explicadas arriba, pero hay dos de ellas que merecen ser mencionadas.

- Debido a que dos de los nodos se est√°n ejecutando en la misma m√°quina, Bob debe especificar una --base-path, --port, --ws-port, and --rpc-port diferentes.

- Bob ha a√±adido la opci√≥n --bootnodes y ha especificad un √∫nico nodo de arranque, llamado Alice. Debe especificar correctamente estos tres datos que Alice puede proporcionarle.
* La direcci√≥n IP de Alice, probablemente, 127.0.0.1
* El puerto de Alice, ella especific√≥ el 30333
* El Peer ID de Alice, copiado desde su log de salida.

Si todo va bien, despu√©s de unos segundos, los nodos deber√≠an comunicarse y empezar a producir bloques. Deber√≠as ver algunas lineas como las siguientes en la consola en la que iniciaste el nodo de Alice.

~~~
Sep 24 12:55:12.755  INFO üí§ Idle (0 peers), best: #0 (0x2533‚Ä¶1d36), finalized #0 (0x2533‚Ä¶1d36), ‚¨á 0 ‚¨Ü 0    
Sep 24 12:55:17.755  INFO üí§ Idle (0 peers), best: #0 (0x2533‚Ä¶1d36), finalized #0 (0x2533‚Ä¶1d36), ‚¨á 0 ‚¨Ü 0    
Sep 24 12:55:21.937  INFO üîç Discovered new external address for our node: /ip4/192.168.0.117/tcp/30333/p2p/12D3KooWEyoppNCUx8Yx66oV9fJnriXwCcXwDDUA2kj6vnc6iDEp    
Sep 24 12:55:21.981  INFO üîç Discovered new external address for our node: /ip4/127.0.0.1/tcp/30333/p2p/12D3KooWEyoppNCUx8Yx66oV9fJnriXwCcXwDDUA2kj6vnc6iDEp    
Sep 24 12:55:22.756  INFO üí§ Idle (1 peers), best: #0 (0x2533‚Ä¶1d36), finalized #0 (0x2533‚Ä¶1d36), ‚¨á 1.2kiB/s ‚¨Ü 1.2kiB/s    
Sep 24 12:55:24.153  INFO üôå Starting consensus session on top of parent 0x2533ac58ba9931d1ed7e1c8779a51d0413c77c4f258691c2819411c457aa1d36    
Sep 24 12:55:24.302  INFO üéÅ Prepared block for proposing at 1 [hash: 0x380c14f5773d8eaf326e9a29f73f992bea1d8c1258dd1ac669073c3aac798036; parent_hash: 0x2533‚Ä¶1d36; extrinsics (1): [0x4ade‚Ä¶ab32]]    
Sep 24 12:55:24.382  INFO üîñ Pre-sealed block for proposal at 1. Hash now 0xd7dfb9b8bf8f36d10a22fcdad0b9753a54c38fed326e837e9639d39eb2895e0c, previously 0x380c14f5773d8eaf326e9a29f73f992bea1d8c1258dd1ac669073c3aac798036.    
Sep 24 12:55:24.385  INFO ‚ú® Imported #1 (0xd7df‚Ä¶5e0c)    
Sep 24 12:55:27.757  INFO üí§ Idle (1 peers), best: #1 (0xd7df‚Ä¶5e0c), finalized #0 (0x2533‚Ä¶1d36), ‚¨á 0.6kiB/s ‚¨Ü 0.7kiB/s    
Sep 24 12:55:30.344  INFO ‚ú® Imported #2 (0xa1cb‚Ä¶562d)    
Sep 24 12:55:32.759  INFO üí§ Idle (1 peers), best: #2 (0xa1cb‚Ä¶562d), finalized #0 (0x2533‚Ä¶1d36), ‚¨á 0.7kiB/s ‚¨Ü 0.6kiB/s    
Sep 24 12:55:36.120  INFO üôå Starting consensus session on top of parent 0xa1cb3ff2f34833ab3bbb0791e8ab894b59dae6cbd83e9aceec49d05b3254562d    
Sep 24 12:55:36.176  INFO üéÅ Prepared block for proposing at 3 [hash: 0xb1e91198d861dfa7fb71489a89871551bef8b92cf0a5a305315fa3221039abaa; parent_hash: 0xa1cb‚Ä¶562d; extrinsics (1): [0x2ac1‚Ä¶af5e]]    
Sep 24 12:55:36.258  INFO üîñ Pre-sealed block for proposal at 3. Hash now 0x632d162c6765b4ad31d7174a7e959ce108c3a4d9e8e1b2dd8c7b84664eb5a43f, previously 0xb1e91198d861dfa7fb71489a89871551bef8b92cf0a5a305315fa3221039abaa.    
Sep 24 12:55:36.260  INFO ‚ú® Imported #3 (0x632d‚Ä¶a43f)    
Sep 24 12:55:37.761  INFO üí§ Idle (1 peers), best: #3 (0x632d‚Ä¶a43f), finalized #1 (0xd7df‚Ä¶5e0c), ‚¨á 0.8kiB/s ‚¨Ü 0.9kiB/s
...
~~~

Estas l√≠neas muestran que Bob se ha conectado con Alice (1 peers), Ellos han producido algunos bloques (best: #3 (0x632d‚Ä¶a43f)), y los bloques est√°n siendo finalizados (finalized #1 (0xd7df‚Ä¶5e0c)).

Mirando la consola donde iniciaste el nodo de Bob, deber√≠as ver algo similar.

Una vez hayamos verificado que ambos nodos est√°n ejecut√°ndose como esper√°bamos, ya puedes apagarlos. La siguiente parte del tutorial incluye comandos para reiniciar los nodos cuando sea necesario.

## Referencias
Configurar reenv√≠o de puertos locales de ssh