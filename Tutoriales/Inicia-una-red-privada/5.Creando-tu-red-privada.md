# Crea tu red privada

Con tu archivo de especificaciones de la blockchain (chain spec) creado y distribuido entre todos los participantes, ya est√°s preparado para poner en marcha tu propia blockchain. En esta parte, no es necesario utilizar una sola m√°quina o un solo binario.

## Primer participante inicia un Bootnode

Has completado todos los pasos de preparaci√≥n necesarios, y ahora est√°s preparado para poner en marcha tu blockchain. Este proceso es muy similar al que hiciste al iniciar la blockchain de Alice y Bob. Es importante empezar con una ruta limpia, as√≠ que, si planeas utilizar la misma ruta que has utilizado anteriormente, por favor, borra todo el contenido del directorio.

La primera participante puede lanzar su nodo con:

~~~
./target/release/node-template \
  --base-path /tmp/node01 \
  --chain ./customSpecRaw.json \
  --port 30333 \
  --ws-port 9944 \
  --rpc-port 9933 \
  --telemetry-url 'wss://telemetry.polkadot.io/submit/ 0' \
  --validator \
  --rpc-methods=Unsafe \
  --name MyNode01
  ~~~

Aqu√≠ hay varias diferencias con respecto a cuando iniciaste el nodo de alicia.

- He omitido la opci√≥n --slice. En su lugar, insertaremos nuestras claves en el keystore a trav√©s de RPC.
- La opci√≥n --chain ha cambiado para poder usar nuestras especificaciones de la blockchain (chain spec).
- He a√±adido la flag opcional --name. Puedes utilizarla para darle un nombre a tu nodo que sea legible para los humanos en la interfaz de usuario de telemetry.
- Se ha a√±adido la flag opcional --rpc-methods=Unsafe. Como su nombre indica, esta opci√≥n no es segura utilizarla en configuraciones en producci√≥n, pero permite a este tutorial centrarse en el tema que quiere.

Deber√≠as ver las siguiente salida por consola:

~~~
Sep 24 13:28:56.804  INFO Substrate Node    
Sep 24 13:28:56.804  INFO ‚úåÔ∏è  version 2.0.0-24da767-x86_64-linux-gnu    
Sep 24 13:28:56.804  INFO ‚ù§Ô∏è  by Substrate DevHub <https://github.com/substrate-developer-hub>, 2017-2020    
Sep 24 13:28:56.804  INFO üìã Chain specification: Local Testnet    
Sep 24 13:28:56.804  INFO üè∑  Node name: MyNode01    
Sep 24 13:28:56.804  INFO üë§ Role: AUTHORITY    
Sep 24 13:28:56.804  INFO üíæ Database: RocksDb at /tmp/node01/chains/local_testnet/db    
Sep 24 13:28:56.804  INFO ‚õì  Native runtime: node-template-1 (node-template-1.tx1.au1)    
Sep 24 13:28:57.188  INFO üî® Initializing Genesis block/state (state: 0xe3cb‚Ä¶c5ca, header-hash: 0x0ded‚Ä¶9b9d)    
Sep 24 13:28:57.191  INFO üë¥ Loading GRANDPA authority set from genesis on what appears to be first startup.    
Sep 24 13:28:57.380  INFO ‚è±  Loaded block-time = 6000 milliseconds from genesis on first-launch    
Sep 24 13:28:57.381  WARN Using default protocol ID "sup" because none is configured in the chain specs    
Sep 24 13:28:57.382  INFO üè∑  Local node identity is: 12D3KooWQa2M77x2hFviVAFLHt9pMUYQVC93fdiVMKDbL3XvYSzj (legacy representation: 12D3KooWQa2M77x2hFviVAFLHt9pMUYQVC93fdiVMKDbL3XvYSzj)    
Sep 24 13:28:57.402  INFO üì¶ Highest known block at #0    
Sep 24 13:28:57.403  INFO „ÄΩÔ∏è Prometheus server started at 127.0.0.1:9615    
Sep 24 13:28:57.434  INFO Listening for new connections on 127.0.0.1:9944.    
Sep 24 13:29:02.436  INFO üí§ Idle (0 peers), best: #0 (0x0ded‚Ä¶9b9d), finalized #0 (0x0ded‚Ä¶9b9d), ‚¨á 0 ‚¨Ü 0    
Sep 24 13:29:07.437  INFO üí§ Idle (0 peers), best: #0 (0x0ded‚Ä¶9b9d), finalized #0 (0x0ded‚Ä¶9b9d), ‚¨á 0 ‚¨Ü 0
~~~

## A√±adir las claves a la keystore

Una vez tu nodo est√° ejecut√°ndose, notar√°s que ning√∫n bloque est√° produci√©ndose. En este punto, necesitas a√±adir tus claves en la keystore. Recuerda que necesitar√°s completar estos pasos para cada nodo en tu red. A√±adir√° dos tipos de claves para cada nodo: claves Aura y GRANDPA. Las Aura keys son necesarias para la producci√≥n de bloques; Las GRANDPA keys son necesarias para la finalizaci√≥n de bloques.

### Opci√≥n 1: Usa la interfaz de usuario Polkadot-JS Apps

Puedes utilizar la interfaz de usuario UI para insertar tus claves en la keystore. Dir√≠jete a la pesta√±a "Toolbox" y a la subpesta√±a "RPC Call". Elija "author" e "insertkey". Estos campos pueden ser rellenados de la siguiente manera:

~~~
keytype: aura
suri: <your mnemonic phrase> (eg. clip organ olive upper oak void inject side suit toilet stick narrow)
publicKey: <your raw sr25519 key> (eg. 0x9effc1668ca381c242885516ec9fa2b19c67b6684c02a8a3237b6862e5c8cd7e
~~~

Si generaste tus claves usando la interfaz de Apps, no conocer√°s tu "raw public key", clave p√∫blica en raw. En ese caso, puedes utilizar tu direcci√≥n SS58(5FfBQ3kwXrbdyoqLPvcXRp7ikWydXawpNs2Ceu3WwFdhZ8W4) en su lugar.
Has introducido con √©xito tu clave de Aura. Puedes repetir estos pasos para insertar tu clave GRANDPA (ed25519 key))

~~~
keytype: gran
suri: <your mnemonic phrase> (eg. clip organ olive upper oak void inject side suit toilet stick narrow)
publicKey: <your raw ed25519 key> (eg. 0xb48004c6e1625282313b07d1c9950935e86894a2e4f21fb1ffee9854d180c781
~~~ 

Si generaste tus claves usando la interfaz de Apps, no conocer√°s tu "raw public key", clave p√∫blica en raw. En ese caso, puedes usar la direcci√≥n SS58(5G9NWJ5P9uk7am24yCKeLZJqXWW6hjuMyRJDmw4ofqxG8Js2).

Si est√°s siguiendo los siguientes pasos para el segundo nodo en la red, debes conectar la UI al segundo nodo antes de insertar las keys.

### Opci√≥n 2: Usa curl

Puedes insertar las claves en el keystore usando curl desde la l√≠nea de comandos. Esta forma puede ser preferible en configuraciones en producci√≥n, d√≥nde puedes usar un servidor privado virtual alojado en la nube.

Dado que la seguridad es una de las mayores preocupaciones en el entorno de producci√≥n, es importante tomar tanta preocupaci√≥n como sea posible. En este caso, queremos decir que tengamos cuidado de no dejar rastros de nuestras claves, como en el historial del terminal. Crea un archivo que usaremos para definir el body de nuestra petici√≥n curl:

~~~
{
  "jsonrpc":"2.0",
  "id":1,
  "method":"author_insertKey",
  "params": [
    "<aura/gran>",
    "<mnemonic phrase>",
    "<public key>"
  ]
}
# Subir una nueva clave por RPC, conectandose a donde est√° escuchando tu "rpc-port"
$ curl http://localhost:9933 -H "Content-Type:application/json;charset=utf-8" -d "@/path/to/file"
~~~

Si introduces el comando y el par√°metro correctamente, el nodo devolver√° una respuesta JSON como la siguiente.

~~~
{ "jsonrpc": "2.0", "result": null, "id": 1 }
~~~

Aseg√∫rese de borrar el archivo que contiene las claves cuando haya acabado.

## Los participantes siguientes se unen

Los siguientes validadores pueden unirse a la red. Esto puede hacerse especificando el par√°metro --bootnodes como hicimos con Bob previamente.

~~~
./target/release/node-template \
  --base-path /tmp/node02 \
  --chain ./customSpecRaw.json \
  --port 30334 \
  --ws-port 9945 \
  --rpc-port 9934 \
  --telemetry-url 'wss://telemetry.polkadot.io/submit/ 0' \
  --validator \
  --rpc-methods=Unsafe \
  --name MyNode02 \
  --bootnodes /ip4/<IP Address>/tcp/<Port>/p2p/<Peer ID>
~~~

Como antes, especificamos otra base-path, le daremos otro nombre, y tambi√©n especificaremos este nodo como validador.

Una vez el segundo nodo est√© levantado, deber√≠as verlos escribiendo:

~~~
Sep 24 13:32:29.909  INFO Substrate Node    
Sep 24 13:32:29.909  INFO ‚úåÔ∏è  version 2.0.0-24da767-x86_64-linux-gnu    
Sep 24 13:32:29.909  INFO ‚ù§Ô∏è  by Substrate DevHub <https://github.com/substrate-developer-hub>, 2017-2020    
Sep 24 13:32:29.909  INFO üìã Chain specification: Local Testnet    
Sep 24 13:32:29.909  INFO üè∑  Node name: MyNode02    
Sep 24 13:32:29.909  INFO üë§ Role: AUTHORITY    
Sep 24 13:32:29.909  INFO üíæ Database: RocksDb at /tmp/node02/chains/local_testnet/db    
Sep 24 13:32:29.909  INFO ‚õì  Native runtime: node-template-1 (node-template-1.tx1.au1)    
Sep 24 13:32:30.342  INFO üî® Initializing Genesis block/state (state: 0xe3cb‚Ä¶c5ca, header-hash: 0x0ded‚Ä¶9b9d)    
Sep 24 13:32:30.346  INFO üë¥ Loading GRANDPA authority set from genesis on what appears to be first startup.    
Sep 24 13:32:30.552  INFO ‚è±  Loaded block-time = 6000 milliseconds from genesis on first-launch    
Sep 24 13:32:30.553  WARN Using default protocol ID "sup" because none is configured in the chain specs    
Sep 24 13:32:30.554  INFO üè∑  Local node identity is: 12D3KooWBHwymjRsTipVZbGqiZV2rtxJiwTjLzPKZ7rYMsa9poUn (legacy representation: 12D3KooWBHwymjRsTipVZbGqiZV2rtxJiwTjLzPKZ7rYMsa9poUn)    
Sep 24 13:32:30.577  INFO üì¶ Highest known block at #0    
Sep 24 13:32:30.611  INFO Listening for new connections on 127.0.0.1:9945.    
Sep 24 13:32:31.126  INFO üîç Discovered new external address for our node: /ip4/127.0.0.1/tcp/30334/p2p/12D3KooWBHwymjRsTipVZbGqiZV2rtxJiwTjLzPKZ7rYMsa9poUn    
Sep 24 13:32:31.175  INFO üîç Discovered new external address for our node: /ip4/192.168.0.117/tcp/30334/p2p/12D3KooWBHwymjRsTipVZbGqiZV2rtxJiwTjLzPKZ7rYMsa9poUn    
Sep 24 13:32:35.614  INFO üí§ Idle (1 peers), best: #0 (0x0ded‚Ä¶9b9d), finalized #0 (0x0ded‚Ä¶9b9d), ‚¨á 1.1kiB/s ‚¨Ü 1.1kiB/s    
Sep 24 13:32:36.844  INFO ‚ú® Imported #1 (0xad75‚Ä¶d784)    
Sep 24 13:32:40.615  INFO üí§ Idle (1 peers), best: #1 (0xad75‚Ä¶d784), finalized #0 (0x0ded‚Ä¶9b9d), ‚¨á 0.2kiB/s ‚¨Ü 0.1kiB/s
~~~

Estas l√≠neas muestran que tu nodo se ha unido con el otro (1 peers), y que han producido un bloque(best: #1 (0x7390‚Ä¶360a)).

Ahora que est√°s listo para a√±adir las claves a la keystore para el siguiente proceso(en la secci√≥n anterior) como hiciste para el primero de los nodos.

Si estas insertando claves con la interfaz de usuario, debes conectarte a la UI desde el websocket endpoint del segundo nodo antes de insertar la clave del segundo nodo.

Un nodo no podr√° producir bloques si no ha a√±adido su clave Aura.

La finalizaci√≥n del bloque s√≥lo puede ocurrir si m√°s de dos tercios de los validadores han agregado sus claves GRANDPA a sus almacenes de claves. Puesto que esta red fue configurada con dos validadores (en el chain spec), la finalizaci√≥n de bloques puede ocurrir despu√©s de de que el segundo nodo haya agregado sus claves (i.e. 50% < 66% < 100%).

Recordatorio: Todos los validadores deben usar especificaciones id√©nticas de la blockchain para poder comunicarse en el protocolo peer to peer. Deber√≠as ver el mismo bloque g√©nesis y state root hashes.

Te dar√°s cuenta que incluso habiendo a√±adido las claves para el segundo nodo, no ha habido ninguna finalizaci√≥n de bloques(finalized #0 (0x3579‚Ä¶2dd2)). Los nodos Substrate requieren reiniciar despues de insertar una clave GRANDPA. "Mata tus nodos" y rein√≠cialos con los mismos comandos que hemos usado anteriormente. Ahora los bloques deber√≠an ser finalizados.

~~~
Sep 24 13:37:33.863  INFO Substrate Node    
Sep 24 13:37:33.864  INFO ‚úåÔ∏è  version 2.0.0-24da767-x86_64-linux-gnu    
Sep 24 13:37:33.864  INFO ‚ù§Ô∏è  by Substrate DevHub <https://github.com/substrate-developer-hub>, 2017-2020    
Sep 24 13:37:33.864  INFO üìã Chain specification: Local Testnet    
Sep 24 13:37:33.864  INFO üè∑  Node name: MyNode02    
Sep 24 13:37:33.864  INFO üë§ Role: AUTHORITY    
Sep 24 13:37:33.864  INFO üíæ Database: RocksDb at /tmp/node02/chains/local_testnet/db    
Sep 24 13:37:33.864  INFO ‚õì  Native runtime: node-template-1 (node-template-1.tx1.au1)    
Sep 24 13:37:33.918  WARN Using default protocol ID "sup" because none is configured in the chain specs    
Sep 24 13:37:33.918  INFO üè∑  Local node identity is: 12D3KooWBHwymjRsTipVZbGqiZV2rtxJiwTjLzPKZ7rYMsa9poUn (legacy representation: 12D3KooWBHwymjRsTipVZbGqiZV2rtxJiwTjLzPKZ7rYMsa9poUn)    
Sep 24 13:37:33.942  INFO üì¶ Highest known block at #23    
Sep 24 13:37:33.973  INFO Listening for new connections on 127.0.0.1:9945.    
Sep 24 13:37:34.486  INFO üîç Discovered new external address for our node: /ip4/127.0.0.1/tcp/30334/p2p/12D3KooWBHwymjRsTipVZbGqiZV2rtxJiwTjLzPKZ7rYMsa9poUn    
Sep 24 13:37:36.593  INFO ‚ú® Imported #24 (0xa7e8‚Ä¶7596)    
Sep 24 13:37:38.976  INFO üí§ Idle (1 peers), best: #24 (0xa7e8‚Ä¶7596), finalized #22 (0x753e‚Ä¶ddb0), ‚¨á 1.5kiB/s ‚¨Ü 1.5kiB/s
~~~

## Has terminado

¬°Enhorabuena! ¬°Has iniciado tu propio blockchain!

En este tutorial has aprendido a generar tus propios pares de claves, crear tu propio archivo de especificaciones de blockchain, que √©ste utilice tus propias claves, e iniciar una red privada usando tu propio archivo de especificaciones.

### Aprende m√°s

Ese gran Wasm blob que encontramos en el chain spec era muy necesario para habilitar las actualizaciones sin bifurcaciones. Aprende m√°s sobre como utiliza el executor utiliza Wasm en la blockchain.