# Crea tu red privada

Con tu archivo de especificaciones de la blockchain (chain spec) creado y distribuido entre todos los participantes, ya est√°s preparado para poner en marcha tu propia blockchain. En esta parte, no es necesario utilizar una sola m√°quina o un solo binario.

## Primer participante inicia un Bootnode

Has completado todos los pasos de preparaci√≥n necesarios, y ahora est√°s preparado para poner en marcha tu blockchain. Este proceso es muy similar al que hiciste al iniciar la blockchain de Alice y Bob. Es importante empezar con una ruta limpia, as√≠ que, si planeas utilizar la misma ruta que has utilizado anteriormente, por favor, borra todo el contenido del directorio.

El primer participante inicia su nodo con:

~~~
./target/release/node-template \
  --base-path /tmp/node01 \
  --chain=./customSpecRaw.json \
  --port 30333 \
  --ws-port 9944 \
  --rpc-port 9933 \
  --telemetry-url 'ws://telemetry.polkadot.io:1024 0' \
  --validator \
  --rpc-methods=Unsafe \
  --name MyNode01
~~~

Aqu√≠ hay varias diferencias con respecto a cuando iniciaste el nodo de alicia:
- He omitido la opci√≥n --slice. En su lugar, insertaremos nuestras claves en el keystore a trav√©s de RPC.

- La opci√≥n --chain ha cambiado para poder usar nuestras especificaciones de la blockchain (chain spec).

- He a√±adido la flag opcional --name. Puedes utilizarla para darle un nombre a tu nodo que sea legible para los humanos en la interfaz de usuario de telemetry.

- Se ha a√±adido la flag opcional --rpc-methods=Unsafe. Como su nombre indica, esta opci√≥n no es segura utilizarla en configuraciones en producci√≥n, pero permite a este tutorial centrarse en el tema que quiere. En producci√≥n, deber√≠as usar SON-RPC proxy, pero ese tema est√° fuera del alcance de este tutorial.

Deber√≠as ver las siguiente salida por consola:

~~~
2020-06-26 11:41:24 Substrate Node
2020-06-26 11:41:24 ‚úåÔ∏è  version 2.0.0-rc4-29f29b9-x86_64-linux-gnu
2020-06-26 11:41:24 ‚ù§Ô∏è  by Substrate DevHub <https://github.com/substrate-developer-hub>, 2017-2020
2020-06-26 11:41:24 üìã Chain specification: Local Testnet
2020-06-26 11:41:24 üè∑  Node name: MyNode01
2020-06-26 11:41:24 üë§ Role: AUTHORITY
2020-06-26 11:41:24 üíæ Database: RocksDb at /tmp/node01/chains/local_testnet/db
2020-06-26 11:41:24 ‚õì  Native runtime: node-template-1 (node-template-1.tx1.au1)
2020-06-26 11:41:24 üî® Initializing Genesis block/state (state: 0x321d‚Ä¶1e25, header-hash: 0x3579‚Ä¶2dd2)
2020-06-26 11:41:24 üë¥ Loading GRANDPA authority set from genesis on what appears to be first startup.
2020-06-26 11:41:24 ‚è±  Loaded block-time = 6000 milliseconds from genesis on first-launch
2020-06-26 11:41:24 üì¶ Highest known block at #0
2020-06-26 11:41:24 Using default protocol ID "sup" because none is configured in the chain specs
2020-06-26 11:41:24 üè∑  Local node identity is: 12D3KooWNjdj9N1nkau1wVbo4E3T3CSNTsvFEBiBTPB7VTPabREL (legacy representation: QmemnA8JEW4yKsQJBcWS9LLAgwpQ1bUqczB6s1PugE2FbU)
2020-06-26 11:41:24 „ÄΩÔ∏è Prometheus server started at 127.0.0.1:9615
2020-06-26 11:41:29 üí§ Idle (0 peers), best: #0 (0x3579‚Ä¶2dd2), finalized #0 (0x3579‚Ä¶2dd2), ‚¨á 0 ‚¨Ü 0
2020-06-26 11:41:34 üí§ Idle (0 peers), best: #0 (0x3579‚Ä¶2dd2), finalized #0 (0x3579‚Ä¶2dd2), ‚¨á 0 ‚¨Ü 0
~~~

## A√±adir las claves a la keystore

Una vez tu nodo est√° ejecut√°ndose, notar√°s que ning√∫n bloque est√° produci√©ndose. En este punto, necesitas a√±adir tus claves en la keystore. Recuerda que necesitar√°s completar estos pasos para cada nodo en tu red.

### Opci√≥n 1: Usar la interfaz de usuario Polkadot-JS

Puedes utilizar la interfaz de usuario UI para insertar tus claves en la keystore. Dir√≠jete a la pesta√±a "Toolbox" y a la subpesta√±a "RPC Call". Elija "author" e "insertkey". Estos campos pueden ser rellenados de la siguiente manera:

~~~
keytype: aura
suri: <your mnemonic phrase> (eg. clip organ olive upper oak void inject side suit toilet stick narrow)
publicKey: <your raw sr25519 key> (eg. 0x9effc1668ca381c242885516ec9fa2b19c67b6684c02a8a3237b6862e5c8cd7e
~~~

Si generaste tus claves usando la interfaz de Apps, no conocer√°s tu "raw public key", clave p√∫blica en raw. En ese caso, puedes utilizar tu direcci√≥n SS58(5FfBQ3kwXrbdyoqLPvcXRp7ikWydXawpNs2Ceu3WwFdhZ8W4) en su lugar.

Has introducido con √©xito tu clave aura. Puedes repetir estos pasos para insertar tu clave grandpa (la clave ed25519)

~~~
keytype: gran
suri: <your mnemonic phrase> (eg. clip organ olive upper oak void inject side suit toilet stick narrow)
publicKey: <your raw ed25519 key> (eg. 0xb48004c6e1625282313b07d1c9950935e86894a2e4f21fb1ffee9854d180c781
~~~

Si generaste tus claves usando la interfaz de Apps, no conocer√°s tu "raw public key", clave p√∫blica en raw. En ese caso, puedes usar la direcci√≥n SS58(5G9NWJ5P9uk7am24yCKeLZJqXWW6hjuMyRJDmw4ofqxG8Js2).

Si est√°s siguiendo los siguientes pasos para el segundo nodo en la red, debes conectar la UI al segundo nodo antes de insertar las keys.

### Opci√≥n 2: Usa curl

Puedes insertar las claves en el keystore usando curl desde la l√≠nea de comandos. Esta forma puede ser preferible en configuraci√≥nes en producci√≥n, d√≥nde puedes usar un servidor privado virtual alojado en la nube.
Dado que la seguridad es una de las mayores preocupaciones en el entorno de producci√≥n, es importante tomar tanta preocupaci√≥n como sea posible. En este caso, queremos decir que tengamos cuidado de no dejar rastros de nuestras claves, como en el historial del terminal. Crea un archivo que usaremos para definir el body de nuestra petici√≥n curl:

~~~
{
  "jsonrpc":"2.0",
  "id":1,
  "method":"author_insertKey",
  "params": [
    "<aura/gran>",
    "<mnemonic phrase>",
    "<public key>"
  ]
}
~~~

~~~
# Subir una nueva clave por RPC, conectandose a donde est√° escuchando tu "rpc-port"
$ curl http://localhost:9933 -H "Content-Type:application/json;charset=utf-8" -d "@/path/to/file"
~~~

Si introduces el comando y el par√°metro correctamente, el nodo devolver√° una respuesta JSON como la siguiente.

~~~
{ "jsonrpc": "2.0", "result": null, "id": 1 }
~~~

Aseg√∫rese de borrar el archivo que contiene las claves cuando haya acabado.

## Los participantes siguientes se unen

Los siguientes validadores pueden unirse a la red. Esto puede hacerse especificando el par√°metro --bootnodes como hicimos con Bob previamente.

~~~
./target/release/node-template \
  --base-path /tmp/node02 \
  --chain ./customSpecRaw.json \
  --port 30334 \
  --ws-port 9945 \
  --rpc-port 9934 \
  --telemetry-url 'ws://telemetry.polkadot.io:1024 0' \
  --validator \
  --rpc-methods=Unsafe \
  --name MyNode02 \
  --bootnodes /ip4/<IP Address>/tcp/<Port>/p2p/<Peer ID>
~~~

Como antes, especificamos otra base-path, le daremos otro nombre, y tambi√©n especificaremos este nodo como validador.

~~~
Una vez el segundo nodo est√© levantado, deber√≠as verlos escribiendo:
2020-06-26 11:59:15 Substrate Node
2020-06-26 11:59:15 ‚úåÔ∏è  version 2.0.0-rc4-29f29b9-x86_64-linux-gnu
2020-06-26 11:59:15 ‚ù§Ô∏è  by Substrate DevHub <https://github.com/substrate-developer-hub>, 2017-2020
2020-06-26 11:59:15 üìã Chain specification: Local Testnet
2020-06-26 11:59:15 üè∑  Node name: MyNode02
2020-06-26 11:59:15 üë§ Role: AUTHORITY
2020-06-26 11:59:15 üíæ Database: RocksDb at /tmp/node02/chains/local_testnet/db
2020-06-26 11:59:15 ‚õì  Native runtime: node-template-1 (node-template-1.tx1.au1)
2020-06-26 11:59:16 üî® Initializing Genesis block/state (state: 0x321d‚Ä¶1e25, header-hash: 0x3579‚Ä¶2dd2)
2020-06-26 11:59:16 üë¥ Loading GRANDPA authority set from genesis on what appears to be first startup.
2020-06-26 11:59:16 ‚è±  Loaded block-time = 6000 milliseconds from genesis on first-launch
2020-06-26 11:59:16 üì¶ Highest known block at #0
2020-06-26 11:59:16 Using default protocol ID "sup" because none is configured in the chain specs
2020-06-26 11:59:16 üè∑  Local node identity is: 12D3KooWP1rFTPCK5y8M5kojZPGUDQSaAHu1ZhMD5rQjjhH3WK8G (legacy representation: QmfB1GxdWQsgXgmubM5u5Vqdn6raR2f9yNhvDg2rtT3bhs)
2020-06-26 11:59:16 Received message on non-registered protocol: [70, 82, 78, 75]
2020-06-26 11:59:16 üîç Discovered new external address for our node: /ip4/127.0.0.1/tcp/30334/p2p/12D3KooWP1rFTPCK5y8M5kojZPGUDQSaAHu1ZhMD5rQjjhH3WK8G
2020-06-26 11:59:16 üîç Discovered new external address for our node: /ip4/192.168.0.113/tcp/30334/p2p/12D3KooWP1rFTPCK5y8M5kojZPGUDQSaAHu1ZhMD5rQjjhH3WK8G
2020-06-26 11:59:21 üí§ Idle (1 peers), best: #0 (0x3579‚Ä¶2dd2), finalized #0 (0x3579‚Ä¶2dd2), ‚¨á 1.0kiB/s ‚¨Ü 1.0kiB/s
2020-06-26 11:59:24 ‚ú® Imported #1 (0x7390‚Ä¶360a)
2020-06-26 11:59:26 üí§ Idle (1 peers), best: #1 (0x7390‚Ä¶360a), finalized #0 (0x3579‚Ä¶2dd2), ‚¨á 0.2kiB/s ‚¨Ü 0.1kiB/s
~~~

Estas l√≠neas muestran que tu nodo se ha unido con el otro (1 peers), y que han producido un bloque(best: #1 (0x7390‚Ä¶360a)).

Ahora que est√°s listo para a√±adir las claves a la keystore para el siguiente proceso(en la secci√≥n anterior) como hiciste para el primero de los nodos.

Si estas insertando claves con la interfaz de usuario, debes conectarte a la UI desde el websocket endpoint del segundo nodo antes de insertar la clave del segundo nodo.

Recordatorio: Todos los validadores deber usar id√©nticas especificaciones de la blockchain para poder comunicarse en el protocolo p2p. Deber√≠as ver el mismo bloque g√©nesis y state root hashes.

Te dar√°s cuenta que incluso habiendo a√±adido las claves para el segundo nodo, no ha habido ninguna finalizaci√≥n de bloques(finalized #0 (0x3579‚Ä¶2dd2)). Los nodos Substrate requieres reiniciar despuer de insertar una clave grandpa. "Mata tus nodos" y rein√≠cialos con los mismos comandos que hemos usado anteriormente. Ahora los bloques deber√≠an ser finalizados.

~~~
2020-06-26 12:02:15 Substrate Node
2020-06-26 12:02:15 ‚úåÔ∏è  version 2.0.0-rc4-29f29b9-x86_64-linux-gnu
2020-06-26 12:02:15 ‚ù§Ô∏è  by Substrate DevHub <https://github.com/substrate-developer-hub>, 2017-2020
2020-06-26 12:02:15 üìã Chain specification: Local Testnet
2020-06-26 12:02:15 üè∑  Node name: MyNode02
2020-06-26 12:02:15 üë§ Role: AUTHORITY
2020-06-26 12:02:15 üíæ Database: RocksDb at /tmp/node02/chains/local_testnet/db
2020-06-26 12:02:15 ‚õì  Native runtime: node-template-1 (node-template-1.tx1.au1)
2020-06-26 12:02:15 üì¶ Highest known block at #16
2020-06-26 12:02:15 Using default protocol ID "sup" because none is configured in the chain specs
2020-06-26 12:02:15 üè∑  Local node identity is: 12D3KooWP1rFTPCK5y8M5kojZPGUDQSaAHu1ZhMD5rQjjhH3WK8G (legacy representation: QmfB1GxdWQsgXgmubM5u5Vqdn6raR2f9yNhvDg2rtT3bhs)
2020-06-26 12:02:15 Received message on non-registered protocol: [70, 82, 78, 75]
2020-06-26 12:02:16 üîç Discovered new external address for our node: /ip4/192.168.0.113/tcp/30334/p2p/12D3KooWP1rFTPCK5y8M5kojZPGUDQSaAHu1ZhMD5rQjjhH3WK8G
2020-06-26 12:02:18 üôå Starting consensus session on top of parent 0x03e6207c6c8ea179ec0fc14cf6d186e9d2de0db8dff535047a44b8cf011182ec
2020-06-26 12:02:18 Timeout fired waiting for transaction pool at block #16. Proceeding with production.
2020-06-26 12:02:18 üéÅ Prepared block for proposing at 17 [hash: 0x60ea2aa720187cf9fabd39496f3799434d0589f961bd497ee0b58a262c65df80; parent_hash: 0x03e6‚Ä¶82ec; extrinsics (1): [0x46e1‚Ä¶e098]]
2020-06-26 12:02:18 üîñ Pre-sealed block for proposal at 17. Hash now 0x9acb23301b81f017289e0657a768170a9bcd2aa37418fec8036fadb97f54ce8d, previously 0x60ea2aa720187cf9fabd39496f3799434d0589f961bd497ee0b58a262c65df80.
2020-06-26 12:02:18 ‚ú® Imported #17 (0x9acb‚Ä¶ce8d)
2020-06-26 12:02:20 üí§ Idle (1 peers), best: #17 (0x9acb‚Ä¶ce8d), finalized #15 (0x806e‚Ä¶c94a), ‚¨á 1.8kiB/s ‚¨Ü 2.0kiB/s
~~~

## Has terminado

¬°Enhorabuena! ¬°Has iniciado tu propio blockchain!

En este tutorial has aprendido a generar tus propios pares de claves, crear tu propio archivo de especificaciones de blockchain, que √©ste utilice tus propias claves, e iniciar una red privada usando tu propio archivo de especificaciones.

### Aprende m√°s

Ese gran Wasm blob que encontramos en el chain spec era muy necesario para habilitar las actualizaciones sin bifurcaciones. Aprende m√°s sobre como utiliza el executor utiliza Wasm en la blockchain.
